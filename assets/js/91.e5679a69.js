(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{609:function(s,n,a){"use strict";a.r(n);var e=a(3),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"wsl2子系统安装centos8及源码编译nginx1-18-php7-4-mysql8-0开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wsl2子系统安装centos8及源码编译nginx1-18-php7-4-mysql8-0开发环境"}},[s._v("#")]),s._v(" WSL2子系统安装CentOS8及源码编译Nginx1.18+PHP7.4+MySql8.0开发环境")]),s._v(" "),a("h2",{attrs:{id:"一、wsl2-安装-centos8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、wsl2-安装-centos8"}},[s._v("#")]),s._v(" 一、WSL2 安装 CentOS8")]),s._v(" "),a("p",[a("strong",[s._v("1、安装 Chocolatey")])]),s._v(" "),a("p",[s._v("NuGet（读作New Get）是用于微软.NET开发平台的软件包管理器，是一个Visual Studio的扩展。Chocolatey 是基于 NuGet 的一个软件包管理器，就像 Linux 中的 yum 或 apt 一样，在 Windows10 中也可以用命令行安装程序了。")]),s._v(" "),a("p",[s._v("右键单击开始菜单，选择 Windows PowerShell(管理员)，打开一个具有管理员权限的 PowerShell 窗口，输入命令并回车：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("完成后，输入命令：choco ，如果能正确显示版本号，说明安装成功。")]),s._v(" "),a("p",[s._v("chocolatey 安装报错失败解决办法")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("警告: An existing Chocolatey installation was detected. Installation will not continue.\nFor security reasons, this script will not overwrite existing installations.\n \nPlease use choco upgrade chocolatey to handle upgrades of Chocolatey itself.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("把C:\\ProgramData\\chocolatey这个目录删除，再重新执行安装程序就可以了。")]),s._v(" "),a("p",[s._v("禁止运行远程脚本，输入以下命令将执行策略设置为允许签名的远程脚本就行了。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("FullyQualifiedErrorId : Unable to unzip package using 7zip. Perhaps try setting $env:chocolateyUseWindowsCompression = 'true' and call install again. Error: 7-Zip signalled an unknown error (code )\n关于解压失败的错误，这个似乎是无法解压的问题，根据错误提示执行如下命令，使Chocolatey使用系统的压缩功能。\n根据提示在powershell(管理员模式）下运行如下命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$env")]),s._v(":chocolateyUseWindowsCompression "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'true'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后在运行安装命令: 同上安装命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("iwr https://chocolatey.org/install.ps1 -UseBasicParsing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" iex\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("或者")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Set-ExecutionPolicy Bypass -Scope Process -Force"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" iex "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("New"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Object System.Net.WebClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".DownloadString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("'https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("chocolatey.org"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install.ps1'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("2、安装 LxRunOffline")])]),s._v(" "),a("p",[s._v("LxRunOffline 是非常实用的 WSL 管理软件，可以备份、创建、恢复、导出WSL子系统，也可以安装适配 WSL 的任何 Linux 发行版，可以将 WSL 子系统安装到任意目录中。")]),s._v(" "),a("p",[s._v("在 PowerShell 窗口中输入命令安装LxRunOffline，安装完成后重启 PowerShell。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("choco "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" lxrunoffline -y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("3、下载 CentOS 镜像")])]),s._v(" "),a("p",[s._v("GitHub 上有开源的适用于 WSL 的 CentOS 系统安装镜像，打开项目页面，选择 CentOS8 分支，进入 docker 目录，下载文件 centos-8-x86_64.tar.xz ，假如下载后保存在 D 盘下。")]),s._v(" "),a("p",[s._v("GitHub下载："),a("a",{attrs:{href:"https://github.com/CentOS/sig-cloud-instance-images/tree/CentOS-8-x86_64/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("strong",[s._v("4、安装 CentOS 镜像")])]),s._v(" "),a("p",[s._v("安装WSL子系统的命令行格式为：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("LxRunOffline install -n 自定义系统名称 -d 安装目录路径 -f 安装包路径.tar.xz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("重新启动 PowerShell，输入命令安装 CentOS 镜像：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("LxRunOffline "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -n centos -d C:/centos -f D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("centos-8-x86_64.tar.xz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("表示将 CentOS 系统安装到 C 盘的 centos 文件夹下，并且命名为 centos。**注意：**Windows 系统命令行中的文件路径和 Linux 系统不同，这里安装目录 C:/ 要用 Linux 方式的反斜线表示，是为了 WSL 使用；而安装包路径 D:\\ 是为了 LxRunOffline 使用，是 Windows 下的路径。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic2.zhimg.com/80/v2-246be13fe127a55b0652797d070d3ed1_720w.png",alt:"img"}})]),s._v(" "),a("p",[s._v("查看所有已安装镜像，能够显示已安装的 centos ，表示安装成功。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("LxRunOffline.exe list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果安装失败也会出现 centos 目录，安装失败重新安装时需要卸载镜像，另外安装目录在 C 盘在卸载时可能存在权限问题，卸载后如果目录没有删除可以手动删除目录。")]),s._v(" "),a("p",[s._v("卸载 WSL 系统镜像命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("LxRunOffline.exe uninstall -n centos\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("5、升级为 WSL2")])]),s._v(" "),a("p",[s._v("输入命令并回车，列出已经安装的 WSL 的信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("wsl -l -v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将对应的 WSL 发行版设为 WSL2，命令格式：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("wsl --set-version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Distro"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中"),a("Distro",[s._v("要和上面查询到的信息一致，本例中为 centos，输入以下命令并回车：")])],1),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("wsl --set-version centos "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输入以下命令并回车，设置默认使用的发行版：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("wsl -s centos\nor\nwslconfig /s centos\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("此时，再次使用命令 wsl -l -v 查看，可以看到 centos 的 VERSION 已经变为 2，并且名称前加了*号（即默认的WSL系统）。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic4.zhimg.com/80/v2-58097abaa0dc965fb8fc26b9f27d7253_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("6、WSL 子系统的启动与关闭")])]),s._v(" "),a("p",[s._v("此时，输入命令 wsl -d centos 即可启动。")]),s._v(" "),a("p",[s._v("停止WSL子系统命令：wsl --shutdown -n 系统名称，如果直接输入 wsl --shutdown ，会停止所有已启动的 WSL 子系统。")]),s._v(" "),a("p",[s._v("在管理员权限的 PoweShell 中输入命令： net stop LxssManager ，也可以停止 WSL 子系统。")]),s._v(" "),a("p",[a("strong",[s._v("7、使用 Windows Terminal")])]),s._v(" "),a("p",[s._v("当然，为了更好的配合 WSL ，一定要安装 Windows Terminal。")]),s._v(" "),a("p",[s._v("有了 Terminal ，可以直接打开所有已安装的 WSL 发行版：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic3.zhimg.com/80/v2-ef4f2fdc1e959ea1fa2200f0be3f2bfa_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("8、目录设置")])]),s._v(" "),a("p",[s._v("在 WSL2 系统中可以直接访问 windows 磁盘文件，因此为了不增加 WSL系统 VHD 虚拟磁盘空间，我个人打算将一些安装软件包放在 F:\\wsl 目录下，将网站web程序放在 E:\\wwwroot 目录中。而在 wsl 系统中的访问路径分别是 /mnt/f/wsl 和 /mnt/e/wwwroot ，当然 WSL 这样直接访问 windows 磁盘会有很大的性能问题。后续使用中如果性能的降低超过了可忍受的程度，再考虑将这两个目录移动到 wsl 的虚拟磁盘。")]),s._v(" "),a("p",[s._v("打开 Windows 安全中心，病毒和威胁防护设置，管理设置，添加或删除排除项，添加排除项，将上述两个目录排除，这样会减少 windows 的系统性能占用。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic4.zhimg.com/80/v2-2f9043628fc1e39672e3ada4da56223b_720w.png",alt:"img"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"二、centos8-基本配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、centos8-基本配置"}},[s._v("#")]),s._v(" 二、centos8 基本配置")]),s._v(" "),a("p",[a("strong",[s._v("1、查看 centos 版本")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("uname -a\ncat /proc/version\ncat /etc/redhat-release\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pic1.zhimg.com/80/v2-3d72747c34ae309226e217ffc32dd014_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("2、安装 wget vim 等工具")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#转到用户目录")]),s._v("\ndnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\ndnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-tools "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用 ifconfig,netstat 等网络 命令")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("3、更换国内源")])]),s._v(" "),a("p",[s._v("(1) 备份原始的yum源")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/yum.repos.d\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS-Base.repo CentOS-Base.repo.bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS-extras.repo CentOS-extras.repo.bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS-centosplus.repo CentOS-centosplus.repo.bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS-PowerTools.repo CentOS-PowerTools.repo.bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" CentOS-AppStream.repo CentOS-AppStream.repo.bak\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("(2) 下载对应版本的repo文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" CentOS-Base.repo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("可以看到 aliyun 的源包含的以下各项：[base] [extras] [centosplus] [PowerTools] [AppStream] ，因此前面对这些源都做了备份。")]),s._v(" "),a("p",[s._v("(3) 清除旧的缓存并生成新的缓存")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf clean all\ndnf makecache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"三、源码编译安装-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、源码编译安装-nginx"}},[s._v("#")]),s._v(" 三、源码编译安装 Nginx")]),s._v(" "),a("p",[a("strong",[s._v("1、安装编译工具及库文件：")])]),s._v(" "),a("p",[s._v("如果缺少某个库文件，在编译时会给出错误提示，可按提示安装缺失的库文件，然后重新进行编译。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("gcc 是是GNU开发的C，C++和Java等多种语言的编译器。")]),s._v(" "),a("p",[s._v("pcre pcre-devel 是一个 perl 库，包括 perl 兼容的正则表达式库，Nginx 的 Rewrite 模块和HTTP 核心模块会使用到 PCRE 来解析正则表达式语法。")]),s._v(" "),a("p",[s._v("zlib zlib-devel 库提供了很多种压缩和解压缩方式，Nginx 启用压缩功能后，将使用 zlib 对 http 包的内容进行 gzip 压缩。")]),s._v(" "),a("p",[s._v("openssl openssl-devel 是实现了SSL协议的开源项目，可以实现秘钥证书管理、对称加密和非对称加密 。用 SSL 加密的安全数据传输通道，保证客户端和服务器之间数据的安全。简单的说就是浏览器以 https 开头的网址访问网站，浏览器和服务器之间数据加密传输。当 Nginx 开启SSL功能后需要此模块的支持。")]),s._v(" "),a("p",[a("strong",[s._v("2、下载并解压：")])]),s._v(" "),a("p",[s._v("打开 nginx 官网 ，可以看到当前最新版本是 nginx-1.19.1 ，下载 nginx-1.19.1.tar.gz 文件并解压。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt/f/wsl "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此目录是我个人存放各种安装包的目录，也就是 win10 的 F 盘 wsl 目录。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://nginx.org/download/nginx-1.19.1.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf nginx-1.19.1.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("3、开始编译")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("  nginx-1.19.1\n./configure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("检查系统环境是否符合编译安装的要求，比如是否有gcc编译工具，是否支持编译参数当中的模块，并根据开启的参数等生成Makefile文件为下一步做准备。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("生成脚本及配置文件，根据Makefile文件生成相应的模块，安装，创建目录，并将生成的模块和文件复制到相应的目录。")]),s._v(" "),a("p",[a("strong",[s._v("4、等待安装完成")])]),s._v(" "),a("p",[s._v("如果没有错误提示，默认安装目录是：/usr/local/nginx，现在可以查看版本，能正确显示版本，说明安装完成。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/nginx/sbin/nginx -V \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("5、添加软链接")])]),s._v(" "),a("p",[s._v("由于 WSL 不能使用 systemd ，使用 service 时会出现错误提示，这里不注册为 service ，而是使用软链接的方式省略执行 nginx 命令的路径前缀。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/nginx/sbin/nginx /usr/bin/nginx\nnginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动服务")]),s._v("\nnginx -s reload  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不停止服务重新载入配置文件")]),s._v("\nnginx -s stop "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止服务")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("6、配置")])]),s._v(" "),a("p",[s._v("创建 Nginx 运行用户及用户组 www ，先停止服务再编辑 nginx.conf 文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" www \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g www www\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/wwwlogs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R www:www /data/wwwlogs\n\nnginx -s stop "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("参考了集成环境 OneinStack 中的配置。默认 user 为 nobody ，修改为 www 。将网站放在 /mnt/e/wwwroot 路径中，即 Win10 本地 E 盘 wwwroot 目录。")]),s._v(" "),a("p",[s._v("fastcgi_pass unix:/dev/shm/php-cgi.sock; 表示 Nginx 和 PHP-FPM 的进程间采用UNIX Domain Socket 方式通信，因此在 PHP-FPM 的配置文件中也要做相应的配置。")]),s._v(" "),a("p",[s._v("最后自动加载 vhost 目录中的配置文件，完整内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('user www www;\nworker_processes auto;\n\nerror_log /data/wwwlogs/error_nginx.log crit;\npid /var/run/nginx.pid;\nworker_rlimit_nofile 51200;\n\nevents {\n  use epoll;\n  worker_connections 51200;\n  multi_accept on;\n}\n\nhttp {\n  include mime.types;\n  default_type application/octet-stream;\n  server_names_hash_bucket_size 128;\n  client_header_buffer_size 32k;\n  large_client_header_buffers 4 32k;\n  client_max_body_size 1024m;\n  client_body_buffer_size 10m;\n  sendfile on;\n  tcp_nopush on;\n  keepalive_timeout 120;\n  server_tokens off;\n  tcp_nodelay on;\n\n  fastcgi_connect_timeout 300;\n  fastcgi_send_timeout 300;\n  fastcgi_read_timeout 300;\n  fastcgi_buffer_size 64k;\n  fastcgi_buffers 4 64k;\n  fastcgi_busy_buffers_size 128k;\n  fastcgi_temp_file_write_size 128k;\n  fastcgi_intercept_errors on;\n\n  #Gzip Compression\n  gzip on;\n  gzip_buffers 16 8k;\n  gzip_comp_level 6;\n  gzip_http_version 1.1;\n  gzip_min_length 256;\n  gzip_proxied any;\n  gzip_vary on;\n  gzip_types\n    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml\n    text/javascript application/javascript application/x-javascript\n    text/x-json application/json application/x-web-app-manifest+json\n    text/css text/plain text/x-component\n    font/opentype application/x-font-ttf application/vnd.ms-fontobject\n    image/x-icon;\n  gzip_disable "MSIE [1-6]\\.(?!.*SV1)";\n\n######################## default ############################\n  server {\n    listen 80;\n    server_name _;\n    access_log /data/wwwlogs/access_nginx.log combined;\n    root /mnt/e/wwwroot/default;\n    index index.html index.htm index.php;\n    #error_page 404 /404.html;\n    #error_page 502 /502.html;\n    #location /nginx_status {\n     # stub_status on;\n     # access_log off;\n     # allow 127.0.0.1;\n     # deny all;\n    #}\n    location ~ [^/]\\.php(/|$) {\n      #fastcgi_pass 127.0.0.1:9000;\n      fastcgi_pass unix:/dev/shm/php-cgi.sock;\n      fastcgi_index index.php;\n      include fastcgi.conf;\n    }\n    location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ {\n      expires 30d;\n      access_log off;\n    }\n    location ~ .*\\.(js|css)?$ {\n      expires 7d;\n      access_log off;\n    }\n    location ~ ^/(\\.user.ini|\\.ht|\\.git|\\.svn|\\.project|LICENSE|README.md) {\n      deny all;\n    }\n  }\n########################## vhost #############################\n  include vhost/*.conf;\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br")])]),a("p",[s._v("错误提示：")]),s._v(" "),a("blockquote",[a("p",[s._v('unknown directive "stub_status" in /usr/local/nginx/conf/nginx.conf:64')])]),s._v(" "),a("p",[s._v("stub_status模块主要用于查看Nginx的一些状态信息，默认不会编译进Nginx，在配置文件中就不能有stub_status 相关配置信息。")]),s._v(" "),a("p",[a("strong",[s._v("7、测试")])]),s._v(" "),a("p",[s._v("启动命令：nginx ，没有出现任何提示。")]),s._v(" "),a("p",[s._v("查看端口服务是否开启")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -lnt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("打开浏览器")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("输入 http://localhost 或者 http://127.0.0.1，然后回车\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果出现 Welcome to nginx! 页面，说明 WSL 及 Nginx 服务器运行正常。")]),s._v(" "),a("h2",{attrs:{id:"四、源码安装-mysql8-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、源码安装-mysql8-0"}},[s._v("#")]),s._v(" 四、源码安装 MySql8.0")]),s._v(" "),a("p",[a("strong",[s._v("1、下载 MySql8.0")])]),s._v(" "),a("p",[s._v("打开mysql官网，社区版下载页，当前最新版本是 8.0.21，操作系统选择 Linux-Generic ，这里根据自己的系统选择下载文件：mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz，即 x86 架构 64位版本。")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://dev.mysql.com/downloads/mysql",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://dev.mysql.com/downloads"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic2.zhimg.com/80/v2-3953f292c55ed1f2f7411df78d9e98f5_720w.png",alt:"img"}})]),s._v(" "),a("p",[s._v("点击 Download 后，转到文件链接页，在 No thanks,just start my download. 上右键，选择复制链接，在 Centos 中下载链接文件：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt/f/wsl "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此目录是我个人存放各种安装包的目录，也就是 win10 的 F 盘 wsl 目录。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pic3.zhimg.com/80/v2-c79446d3dc3ecca6cf7e92a5ca9dba7a_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("2、解压并配置相关目录与权限")])]),s._v(" "),a("p",[s._v("解压之后，将解压出的目录移动到 /usr/local/ 下并改名为 mysql，切换到 /usr/local/mysql 目录，创建 data 目录，再在根目录下创建 /data/mysql 目录。目录路径可以按自己的需要创建。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf mysql-8.0.21-linux-glibc2.12-x86_64.tar.xz\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" mysql-8.0.21-linux-glibc2.12-x86_64 /usr/local/mysql\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("创建用户组 mysql ，给用户组添加用户 mysql，并给相应的目录权限。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g mysql mysql\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql:mysql /usr/local/mysql/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql:mysql /data/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("3、初始化 MySql")])]),s._v(" "),a("p",[s._v("添加需要的库文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libaio numactl initscripts -y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("初始化，参数要和前面创建的用户及目录对应。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bin/mysqld --initialize --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql --datadir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql/data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行结束会生成数据库root用户密码，做好记录。( A temporary password is generated for root@localhost: Zlg+oqdhy9i=)")]),s._v(" "),a("p",[s._v("如果执行失败,需要删除 data 和 tmp 目录下所有内容，根据错误提示，检查配置后重新执行初始化。")]),s._v(" "),a("p",[a("strong",[s._v("4、创建并配置 my.cnf 文件")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /etc/my.cnf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("my.cnf 参考了集成环境 OneinStack 中的配置，内容如下。同样，my.cnf 配置文件中的目录路径也要和前面mysql初始化时的一致。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[client]\nport = 3306\nsocket = /tmp/mysql.sock\ndefault-character-set = utf8mb4\n\n[mysql]\nprompt=\"MySQL [\\d]> \"\nno-auto-rehash\n\n[mysqld]\nport = 3306\nsocket = /tmp/mysql.sock\ndefault_authentication_plugin = mysql_native_password\n\nbasedir = /usr/local/mysql\ndatadir = /usr/local/mysql/data\npid-file = /data/mysql/mysql.pid\nuser = mysql\nbind-address = 0.0.0.0\nserver-id = 1\n\ninit-connect = 'SET NAMES utf8mb4'\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\nskip-name-resolve\n#skip-networking\nback_log = 300\n\nmax_connections = 1259\nmax_connect_errors = 6000\nopen_files_limit = 65535\ntable_open_cache = 1024\nmax_allowed_packet = 500M\nbinlog_cache_size = 1M\nmax_heap_table_size = 8M\ntmp_table_size = 128M\n\nread_buffer_size = 2M\nread_rnd_buffer_size = 8M\nsort_buffer_size = 8M\njoin_buffer_size = 8M\nkey_buffer_size = 256M\n\nthread_cache_size = 64\n\nft_min_word_len = 4\n\nlog_bin = mysql-bin\nbinlog_format = mixed\nbinlog_expire_logs_seconds = 604800\n\nlog_error = /data/mysql/mysql-error.log\nslow_query_log = 1\nlong_query_time = 1\nslow_query_log_file = /data/mysql/mysql-slow.log\n\nperformance_schema = 0\nexplicit_defaults_for_timestamp\n\n#lower_case_table_names = 1\n\nskip-external-locking\n\ndefault_storage_engine = InnoDB\n#default-storage-engine = MyISAM\ninnodb_file_per_table = 1\ninnodb_open_files = 500\ninnodb_buffer_pool_size = 1024M\ninnodb_write_io_threads = 4\ninnodb_read_io_threads = 4\ninnodb_thread_concurrency = 0\ninnodb_purge_threads = 1\ninnodb_flush_log_at_trx_commit = 2\ninnodb_log_buffer_size = 2M\ninnodb_log_file_size = 32M\ninnodb_log_files_in_group = 3\ninnodb_max_dirty_pages_pct = 90\ninnodb_lock_wait_timeout = 120\n\nbulk_insert_buffer_size = 8M\nmyisam_sort_buffer_size = 64M\nmyisam_max_sort_file_size = 10G\nmyisam_repair_threads = 1\n\ninteractive_timeout = 28800\nwait_timeout = 28800\n\n[mysqldump]\nquick\nmax_allowed_packet = 500M\n\n[myisamchk]\nkey_buffer_size = 256M\nsort_buffer_size = 8M\nread_buffer = 4M\nwrite_buffer = 4M\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br")])]),a("p",[a("strong",[s._v("5、启动 MySql")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/mysql/support-files/mysql.server start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("只创建软链接，不配置环境变量。因为使用 mysql 命令登录数据库，或使用 mysqldump 命令备份数据库，都不常用，要用的时候直接使用绝对路径。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/mysql/support-files/mysql.server /usr/bin/mysqld\nmysqld start "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动mysql")]),s._v("\nmysqld stop "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止mysql")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -lnt "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看已开放的端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查看所有可用的命令参数")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mysqld --help\nUsage: mysqld  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("start"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("reload"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("force-reload"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" MySQL server options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("6、修改密码")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/mysql/bin/mysql -uroot -p\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入初始化时记录的密码")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录后在命令提示符 MySQL [(none)]> 后，输入如下语句并回车")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(MySql语句要以;结束，password 修改成自己的新密码)")]),s._v("\n\nalter user "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" identified by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退出")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("7、安装过程中的报错及处理方法")])]),s._v(" "),a("blockquote",[a("p",[s._v("/etc/redhat-lsb/lsb_log_message: line 3: /etc/init.d/functions: No such file or directory")])]),s._v(" "),a("p",[s._v("解决方法是安装initscripts： dnf -y install initscripts")]),s._v(" "),a("blockquote",[a("p",[s._v("mysqld_safe error: log-error set to '/data/mysql/mysql-error.log', however file don't exists. Create writable for user 'mysql'.")])]),s._v(" "),a("p",[s._v("解决方法是：创建此文件并给予 mysql 组和用户权限")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /data/mysql/mysql-error.log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql:mysql /data/mysql/mysql-error.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如下报错也可以尝试用此方法解决")]),s._v(" "),a("blockquote",[a("p",[s._v("The server quit without updating PID file (/data/mysql/mysql.pid)")])]),s._v(" "),a("h2",{attrs:{id:"五、源码编译安装-php7-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、源码编译安装-php7-4"}},[s._v("#")]),s._v(" 五、源码编译安装 php7.4")]),s._v(" "),a("p",[a("strong",[s._v("1、下载")])]),s._v(" "),a("p",[s._v("打开PHP官网，看到当前最新版本是 7.4.9，由于官网国内下载很慢，找到一个国内的库，下载源码文件。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt/f/wsl "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#此目录是我个人存放各种安装包的目录，也就是 win10 的 F 盘 wsl 目录。 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirrors.sohu.com/php/php-7.4.9.tar.xz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("2、安装编译工具和库")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在安装 Nginx 时就已经安装过编译工具和库，在检查配置编译参数时，提示缺少哪个就安装哪个库。")]),s._v(" "),a("p",[a("strong",[s._v("3、创建用户组和用户")])]),s._v(" "),a("p",[s._v("如果在安装 Nginx 时已经创建过，就不用再重复创建了。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" www\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g www www\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("4、配置编译")])]),s._v(" "),a("p",[s._v("解压缩，移动到 /usr/local/ 目录并重命名为 php，切换到 /usr/local/php 目录。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf php-7.4.9.tar.xz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" php-7.4.9 /usr/local/php\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查看已安装的 php 编译参数命令是：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("php -i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" configure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以下编译参数来源于 oneinstack 集成包，复制以下所有内容到 CentOS 命令行窗口，回车，开始检查配置。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("./configure --prefix=/usr/local/php \\\n--with-config-file-path=/usr/local/php/etc \\\n--with-config-file-scan-dir=/usr/local/php/etc/php.d \\\n--with-fpm-user=www \\\n--with-fpm-group=www \\\n--enable-fpm \\\n--enable-opcache \\\n--disable-fileinfo \\\n--enable-mysqlnd \\\n--with-mysqli=mysqlnd \\\n--with-pdo-mysql=mysqlnd \\\n--with-iconv-dir=/usr/local/libiconv \\\n--with-freetype \\\n--with-jpeg \\\n--with-zlib \\\n--enable-xml \\\n--disable-rpath \\\n--enable-bcmath \\\n--enable-shmop \\\n--enable-exif \\\n--enable-sysvsem \\\n--enable-inline-optimization \\\n--with-curl=/usr/local/curl \\\n--enable-mbregex \\\n--enable-mbstring \\\n--with-password-argon2 \\\n--with-sodium=/usr/local \\\n--enable-gd \\\n--with-openssl=/usr/local/openssl \\\n--with-mhash \\\n--enable-pcntl \\\n--enable-sockets \\\n--with-xmlrpc \\\n--enable-ftp \\\n--enable-intl \\\n--with-xsl \\\n--with-gettext \\\n--with-zip=/usr/local \\\n--enable-soap \\\n--disable-debug \\\nPKG_CONFIG_PATH=/usr/local/lib/pkgconfig/:\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("一遍遍执行上述检查配置，根据报错 error 或类似 not found 类，解决错误。直到出现如下所示：Thank you for using PHP")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic3.zhimg.com/80/v2-3a32bea087e389343ab3fecce33a2de6_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("5、安装完成")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pic1.zhimg.com/80/v2-c4571d973eb887850368a26b618a0d08_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("6、报错及解决")])]),s._v(" "),a("blockquote",[a("p",[s._v('configure: error: C++ preprocessor "/lib/cpp" fails sanity check')])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" glibc-headers gcc-c++\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("Package 'libxml-2.0', required by 'virtual:world', not found\nPackage 'sqlite3', required by 'virtual:world', not found\nPackage 'libcurl', required by 'virtual:world', not found\nPackage 'libpng', required by 'virtual:world', not found\nPackage 'libjpeg', required by 'virtual:world', not found\nPackage 'freetype', required by 'virtual:world', not found\nPackage 'icu-uc', required by 'virtual:world', not found\nPackage 'libsodium', required by 'virtual:world', not found")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libxml2-devel sqlite-devel libcurl-devel libpng-devel libjpeg-devel freetype-devel libicu-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("Package 'oniguruma', required by 'virtual:world', not found")])]),s._v(" "),a("p",[s._v("oniguruma是一个处理正则表达式的库")]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/kkos/oniguruma/archive/v6.9.4.tar.gz -O oniguruma-6.9.4.tar.gz \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf oniguruma-6.9.4.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" oniguruma-6.9.4/\n./autogen.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./configure --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("Generating autotools files.\n./autogen.sh: line 6: autoreconf: command not found")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" autoconf automake libtool\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次检查配置，没有问题了，再生成脚本及配置文件，安装。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./autogen.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./configure --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("configure: error: Package requirements (libsodium >= 1.0.8) were not met:\nPackage 'libsodium', required by 'virtual:world', not found")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("p",[s._v("Sodium 是一个全新而且易用的加密库，用于加密、解密、签名和生成密码哈希等等。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.libsodium.org/libsodium/releases/libsodium-1.0.18-stable.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxf libsodium-1.0.18-stable.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" libsodium-stable\n./configure --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\nldconfig\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("checking for Argon2 library... not found\nconfigure: error: Please ensure the argon2 header and library are installed")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("p",[s._v("打开 "),a("a",{attrs:{href:"http://pkgs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://pkgs.org"),a("OutboundLink")],1),s._v(" ，查找 libargon2 ，找到 centos8 的rpm包，下载安装。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download-ib01.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/l/libargon2-20171227-3.el8.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download-ib01.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/l/libargon2-devel-20171227-3.el8.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -Uvh libargon2-20171227-3.el8.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -Uvh libargon2-devel-20171227-3.el8.x86_64.rpm\ndnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libargon2 libargon2-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("configure: error: Package requirements (libxslt >= 1.1.0) were not met:\nPackage 'libxslt', required by 'virtual:world', not found")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libxslt libxslt-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("Failed to set locale, defaulting to C.UTF-8\nerror: rpmdb: BDB2034 unable to allocate memory for mutex; resize mutex region\nerror: cannot open Packages index using db5 - Cannot allocate memory (12)\nerror: cannot open Packages database in /var/lib/rpm\nError: Error: rpmdb open failed")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("p",[s._v("一般是由于rpm本地数据库损坏导致的。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/rpm      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm db所在目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db.'")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出相关rpm db文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f __db.*     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清除原rpmdb文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" --rebuilddb     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重建rpm数据库")]),s._v("\nyum clean all\ndnf makecache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("Package 'libzip', required by 'virtual:world', not found")])]),s._v(" "),a("p",[s._v("解决方法：")]),s._v(" "),a("p",[s._v("打开 "),a("a",{attrs:{href:"http://pkgs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://pkgs.org"),a("OutboundLink")],1),s._v(" ，查找 libzip 及 libzip-devel，找到 centos8 的rpm包，下载安装。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirror.centos.org/centos/8/AppStream/x86_64/os/Packages/libzip-1.5.2-1.module_el8.2.0+314+53b99e08.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://mirror.centos.org/centos/8/AppStream/x86_64/os/Packages/libzip-devel-1.5.2-1.module_el8.2.0+314+53b99e08.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -Uvh libzip-1.5.2-1.module_el8.2.0+314+53b99e08.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -Uvh libzip-devel-1.5.2-1.module_el8.2.0+314+53b99e08.x86_64.rpm\ndnf -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libzip libzip-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("7、配置")])]),s._v(" "),a("p",[s._v("生成 php 配置文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" php.ini-production /usr/local/php/etc/php.ini\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在编译时启用了参数：--enable-opcache ，查找 opcache.so模块文件所在路径。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /usr -name opcache.so\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###输出###")]),s._v("\n/usr/local/php/ext/opcache/.libs/opcache.so\n/usr/local/php/lib/php/extensions/debug-non-zts-20190902/opcache.so\n/usr/local/php/modules/opcache.so\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("编辑 php.ini 文件，在末尾添加如下内容，开启 OPcache 扩展")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("opcache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("zend_extension")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/php/modules/opcache.so\nopcache.enable"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nopcache.enable_cli"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nopcache.memory_consumption"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("\nopcache.interned_strings_buffer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nopcache.max_accelerated_files"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\nopcache.revalidate_freq"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nopcache.file_cache"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/opcache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("生成 php-fpm 配置文件并编辑。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/php/etc\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" php-fpm.conf.default php-fpm.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" php-fpm.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这里还是参考 OneInStack 集成环境包中的配置，清空 php-fpm.conf 内容，修改如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(";;;;;;;;;;;;;;;;;;;;;\n; FPM Configuration ;\n;;;;;;;;;;;;;;;;;;;;;\n\n;;;;;;;;;;;;;;;;;;\n; Global Options ;\n;;;;;;;;;;;;;;;;;;\n\n[global]\npid = run/php-fpm.pid\nerror_log = log/php-fpm.log\nlog_level = warning\n\nemergency_restart_threshold = 30\nemergency_restart_interval = 60s\nprocess_control_timeout = 5s\ndaemonize = yes\n\n;;;;;;;;;;;;;;;;;;;;\n; Pool Definitions ;\n;;;;;;;;;;;;;;;;;;;;\n\n[www]\nlisten = /dev/shm/php-cgi.sock\nlisten.backlog = -1\nlisten.allowed_clients = 127.0.0.1\nlisten.owner = www\nlisten.group = www\nlisten.mode = 0666\nuser = www\ngroup = www\n\npm = dynamic\npm.max_children = 50\npm.start_servers = 30\npm.min_spare_servers = 20\npm.max_spare_servers = 50\npm.max_requests = 2048\npm.process_idle_timeout = 10s\nrequest_terminate_timeout = 120\nrequest_slowlog_timeout = 0\n\npm.status_path = /php-fpm_status\nslowlog = var/log/slow.log\nrlimit_files = 51200\nrlimit_core = 0\n\ncatch_workers_output = yes\n;env[HOSTNAME] = aliyun-wxy\nenv[PATH] = /usr/local/bin:/usr/bin:/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("p",[s._v("本配置文件指定了 PHP-FPM 进程通信方式：listen = /dev/shm/php-cgi.sock，和 Nginx 的配置保持了一致。")]),s._v(" "),a("p",[s._v("生成 php-fpm 服务启动文件：（新的文件名不能有 - 字符）")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/local/php/sapi/fpm/init.d.php-fpm /usr/bin/phpfpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("740")]),s._v(" /usr/bin/phpfpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("测试启动php-fpm")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("phpfpm start\nphpfpm restart\nphpfpm stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("查看 php 已启用的模块：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("php -m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看 php 版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/php/bin/php -v\nphp -v\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("8、安装配置 Xdebug")])]),s._v(" "),a("p",[s._v("OPcache 扩展是 PHP7.X 自带的，只要在编译时开启，就可以配置使用。而 Xdebug 需要另外安装。参考 xdebug 官网文档。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git://github.com/xdebug/xdebug.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" xdebug\nphpize\n./configure --enable-xdebug\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pic1.zhimg.com/80/v2-66d253067bd83ca208f5334eac463e48_720w.png",alt:"img"}})]),s._v(" "),a("p",[s._v("Xdebug编译完成后显示扩展文件目录、提示将扩展添加到 php.ini文件")]),s._v(" "),a("p",[s._v("编辑 php.ini ，在末尾增加 xdebug.so扩展。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/php/etc/php.ini\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("####增加xdebug.so扩展###")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("zend_extension")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/php/lib/php/extensions/debug-non-zts-20190902/xdebug.so"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("重启 php-fpm ，检查 php 扩展")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/bin/php-fpm restart\nphp -m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"六、lnmp-环境测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、lnmp-环境测试"}},[s._v("#")]),s._v(" 六、LNMP 环境测试")]),s._v(" "),a("p",[a("strong",[s._v("1、Nginx 和 PHP-FPM 的配合")])]),s._v(" "),a("p",[s._v("Nginx 和 PHP-FPM 的进程间通信有两种方式，一种是TCP，另一种是 UNIX Domain Socket。")]),s._v(" "),a("p",[s._v("其中 TCP 方式是 IP 加端口，可以跨服务器。而 UNIX Domain Socket 不经过网络,只能用于Nginx 跟 PHP-FPM 都在同一服务器的场景。不管用哪种方式在 Nginx 和 PHP-FPM 配置时要统一。")]),s._v(" "),a("p",[s._v("方式1: TCP")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("php-fpm.conf 文件配置: listen = 127.0.0.1:9000\nnginx.conf 文件配置: fastcgi_pass 127.0.0.1:9000;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("方式2: UNIX Domain Socket")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("php-fpm.conf 文件配置: listen = /tmp/php-fpm.sock\nnginx.conf 文件配置: fastcgi_pass unix:/tmp/php-fpm.sock;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("其中 php-fpm.sock 是一个文件，由 php-fpm 生成，如果在 php-fpm.conf 配置文件中指定的用户和组是 www ，确保 /tmp/php-fpm.sock 的权限是 www:www。")]),s._v(" "),a("p",[a("strong",[s._v("2、测试 phpinfo 文件")])]),s._v(" "),a("p",[s._v("在浏览器中打开内容为 phpinfo() 函数的 PHP 文件，如果 nginx 出现错误，则说明 php 无法配合 Nginx 运行， 请查看 nginx 错误日志。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /data/wwwlogs/error_nginx.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pic4.zhimg.com/80/v2-83101ea9770deaaf2cc31bf441b744a3_720w.png",alt:"img"}})]),s._v(" "),a("p",[s._v("phpinfo 显示了编译参数、 php.ini 的文件位置、已开启OPcache 及 Xdebug 扩展等信息")]),s._v(" "),a("p",[a("strong",[s._v("3、phpMyAdmin")])]),s._v(" "),a("p",[s._v("下载 phpMyAdmin 并解压到 /mnt/e/wwwroot/default 目录，即 Nginx 配置文件中指定的默认网站目录。在浏览器中打开 localhost/phpMyAdmin/ ，如果能顺利登录数据库，则说明不但 Nginx 和 php 没有问题，而且 Mysql 也没有问题。至此，Nginx php Mysql 已经完全能配合运行了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic4.zhimg.com/80/v2-40c0b426e239923a97561d0d417e582b_720w.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("4、关于开机自动启动服务")])]),s._v(" "),a("p",[s._v("通常在 Linux 中开机启动可以通过编辑/etc/rc.loacl 文件、在/etc/init.d/ 下添加启动脚本或者配置systemd 实现，但是关于由于 WSL 架构的特殊性，并且不支持 systemd ，这几种方式在 WSL 子系统中无法使用。而在 Windows 中用 VBS 脚本结合 WSL 命令的实现开机启动的方式似乎存在不能使用 LocalHost 地址访问子系统的问题。总之，暂时还是手动启动吧。")]),s._v(" "),a("p",[s._v("如前述，已安装的 Nginx、PHP、MySql 启动及停止命令总结如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动nginx服务")]),s._v("\nphpfpm start "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动php-fpm服务")]),s._v("\nmysqld start "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动mysql")]),s._v("\n\n\nnginx -s reload  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不停止服务重新载入配置文件")]),s._v("\nnginx -s stop "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止服务")]),s._v("\n\nphpfpm restart\nphpfpm stop\n\nmysqld restart "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启mysql")]),s._v("\nmysqld stop "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止mysql")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://pic4.zhimg.com/80/v2-6b9172a8a0ff8d0ed733fd049b76cf7b_720w.png",alt:"img"}})])])}),[],!1,null,null,null);n.default=t.exports}}]);